<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Building applications with Grails</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Building applications with Grails</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_from_zero_to_hero">From Zero to Hero</a>
<ul class="sectlevel2">
<li><a href="#_installing_grails">Installing Grails</a></li>
<li><a href="#_installing_groovy">Installing Groovy</a></li>
<li><a href="#_references">References</a></li>
<li><a href="#_creating_the_application">Creating the application</a></li>
</ul>
</li>
<li><a href="#_getting_groovy">Getting Groovy</a>
<ul class="sectlevel2">
<li><a href="#_simpler_java">Simpler Java</a></li>
<li><a href="#_strings">Strings</a></li>
<li><a href="#_dynamic_typing">Dynamic typing</a></li>
<li><a href="#_closures">Closures</a></li>
<li><a href="#_collections">Collections</a></li>
</ul>
</li>
<li><a href="#_scaffolding">Scaffolding</a>
<ul class="sectlevel1">
<li><a href="#_create_a_domain_class">Create a domain class</a></li>
<li><a href="#_creating_the_controller">Creating the controller</a></li>
<li><a href="#_exercise">Exercise</a></li>
</ul>
</li>
<li><a href="#_relationships_and_constraints">Relationships and constraints</a>
<ul class="sectlevel1">
<li><a href="#_relationships">Relationships</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_datasource">Datasource</a></li>
<li><a href="#_bootstrapping">Bootstrapping</a></li>
<li><a href="#_logging">Logging</a></li>
</ul>
</li>
<li><a href="#_views_and_controllers">Views and controllers</a>
<ul class="sectlevel2">
<li><a href="#_building_the_controller">Building the controller</a></li>
<li><a href="#_building_the_view">Building the view</a></li>
<li><a href="#_generating_views_and_controllers">Generating views and controllers</a></li>
</ul>
</li>
<li><a href="#_custom_tag">Custom tag</a>
<ul class="sectlevel2">
<li><a href="#_i18n">i18n</a></li>
<li><a href="#_exercise_2">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_layout">Layout</a>
<ul class="sectlevel1">
<li><a href="#_changing_the_index_page">Changing the index page</a></li>
<li><a href="#_using_templates">Using templates</a></li>
<li><a href="#_exercise_3">Exercise</a></li>
<li><a href="#_testing">Testing</a>
<ul class="sectlevel2">
<li><a href="#_simple_unit_test">Simple unit test</a></li>
<li><a href="#_testing_controllers">Testing controllers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_plugins">Plugins</a></li>
<li><a href="#_security">Security</a>
<ul class="sectlevel1">
<li><a href="#_installing_the_plugin">Installing the plugin</a></li>
<li><a href="#_users_and_roles">Users and roles</a>
<ul class="sectlevel2">
<li><a href="#_exercise_4">Exercise</a></li>
</ul>
</li>
<li><a href="#_securing_controllers">Securing controllers</a>
<ul class="sectlevel2">
<li><a href="#_exercise_5">Exercise</a></li>
</ul>
</li>
<li><a href="#_logout">Logout</a>
<ul class="sectlevel2">
<li><a href="#_exercise_6">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_solutions">Solutions</a>
<ul class="sectlevel1">
<li><a href="#_scaffolding_2">Scaffolding</a></li>
<li><a href="#_views_and_controllers_2">Views and controllers</a></li>
<li><a href="#_layout_2">Layout</a></li>
<li><a href="#_security_2">Security</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Workshop where we learn how to build application using the Grails platform.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>JDK 11 - <a href="https://sdkman.io" class="bare">https://sdkman.io</a></p>
</li>
<li>
<p>Grails - <a href="https://grails.org" class="bare">https://grails.org</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_from_zero_to_hero">From Zero to Hero</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose we are a superhero, ready to fight crime in our city. We want to build a system where we can keep a record of all villains we can encounter. We call the software system G.R.A.I.L.S (Great Rapid Action Intelligence Law-enforcement System). We want to be able to easily to save and find information about them. Of course we want to use a software platform where we can be productive and start immediately. That&#8217;s why we will be using Grails to build our system.</p>
</div>
<div class="sect2">
<h3 id="_installing_grails">Installing Grails</h3>
<div class="paragraph">
<p>Before we can start to develop our application we must first install Grails. The easiest way to install Grails is to download the latest version from the <a href="https://github.com/grails/grails-core/releases/download/v5.1.2/grails-5.1.2.zip">Grails website</a>. Then we must unzip the downloaded file into a directory of our choice.</p>
</div>
<div class="paragraph">
<p>We add the directory <code>bin</code> from the unzipped directory to our <code>PATH</code> so we can invoke Grails commands from the command-line. Suppose we have unzipped the Grails distribution to a directory <code>/Software/Grails/5.1.2</code> then we add the directory <code>/Software/Grails/5.1.2</code> to the <code>PATH</code> system environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>> export PATH=$PATH:/Software/Grails/5.1.2/bin</pre>
</div>
</div>
<div class="paragraph">
<p>If we have a Windows computer we use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>> set PATH=%PATH%;/Software/Grails/5.1.2/bin</pre>
</div>
</div>
<div class="paragraph">
<p>This will change the <code>PATH</code> variable for the current command-line session in Windows. If want to change the <code>PATH</code> variable for the whole computer we must change it via <code>My Computer/Advanced/Environment Variables</code>.</p>
</div>
<div class="paragraph">
<p>To check if Grails is installed correctly we type from the command line <code>grails -version</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>> grails -version
Grails version: 5.1.2</pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t see this output we might want to check we have Java in our <code>PATH</code> and recheck the contents of our <code>PATH</code> variable.</p>
</div>
<div class="sect3">
<h4 id="_alternative_installation">Alternative installation</h4>
<div class="paragraph">
<p>For Linux and Mac OSX users there is an alternative way to install Grails using <a href="http://sdkman.io/install.html">sdkman</a> (SDK Manager).
SDKMAN is a tool for managing multiple versions of Groovy and Groovy related frameworks.
We can install SDKMAN first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; curl -s get.sdkman.io | bash</pre>
</div>
</div>
<div class="paragraph">
<p>Next we can install the a specific Grails version with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>> sdk install grails 5.1.2</pre>
</div>
</div>
<div class="paragraph">
<p>SDKMAN will download the Grails distribution and saved it in our user home directory <code>~/.sdk/grails</code>.
Also all environment variables are configured. We might need to restart our command-line shell, but then we are ready to use Grails.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_groovy">Installing Groovy</h3>
<div class="paragraph">
<p>To play around with some Groovy language features we also want to install Groovy 3.0.9.
The easiest way to install Groovy is using SDKMAN.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>> sdk install groovy 3.0.9</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.grails.org">Grails website</a></p>
</li>
<li>
<p><a href="https://grails.org/documentation.html">Grails documentation</a></p>
</li>
<li>
<p><a href="https://grails.org/single-page-documentation.html">Grails user guide</a></p>
</li>
<li>
<p><a href="https://groovy-lang.org">Groovy website</a></p>
</li>
<li>
<p><a href="http://sdkman.io">sdkman website</a></p>
</li>
<li>
<p><a href="http://mrhaki.blogspot.com/search/label/Grails%3AGoodness">Grails Goodness</a></p>
</li>
<li>
<p><a href="http://blog.jdriven.com/">JDriven Blog</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_application">Creating the application<a id="creating-the-app"></a></h3>
<div class="paragraph">
<p>Grails is a web platform and this means it is not only a set of libraries, but also contains a complete build system. Once we have downloaded and installed Grails on our computer, we don&#8217;t need anything else to get started. Let&#8217;s create our application. We first open a command-line and change to a directory where we want to create our application. Then we invoke the command <code>create-app</code> with the <code>grails</code> script. The <code>grails</code> script can be found in the <code>bin/</code> folder of the Grails installation directory. With this script we can invoke Grails command and later we will see more commands we can invoke.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create our application with the name <code>heroes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails create-app heroes
| Application created at /Users/mrhaki/Projects/workshop-grails/heroes
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Once we have invoked the <code>create-app</code> command we can see in the output where our new application is created. We can change to this directory and startup our application for the first time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; cd heroes
&gt; grails run-app
...
| Running application...
Grails application running at http://localhost:8080 in environment: development
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the output we see that our application is started and is reachable via <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a>. We open a web browser and browse to this URL to see what we have got.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/first-app.png" alt="first app">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If we would want to deploy our application to an existing Java application server we can package our application as a WAR file with the <code>war</code> command. The resulting WAR file is JVM compatible and can be deployed to for example Tomcat, Websphere, Glassfish or any other Java application server. There are no other dependencies, because everything is in the generated WAR file. Another deployment solution is to build the application as a runnable JAR file. Then we only need to deploy the JAR file and use the <code>java -jar</code> command to run it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To stop our application we can simply press <code>Ctrl+C</code> and our application is stopped.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_groovy">Getting Groovy<a id="getting-groovy"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grails is a web platform to write web application. The language used for writing the code is Groovy. Groovy is a programming language for the Java platform. This means we can write our code in Groovy and this is then compiled into Java byte code and can be executed on any Java Virtual Machine (JVM). The syntax of Groovy is not that hard if we are used to Java. It looks a lot like Java code and we can even use Java libraries in Groovy. Also we could write Groovy code and use it in Java applications.</p>
</div>
<div class="paragraph">
<p>Before we can start on our web application it is good to first learn a bit about Groovy and play around with it. To experiment with some Groovy code we can start up a GUI console application from Groovy. In the console application we can type in Groovy code and execute it immediately.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start up the console with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; groovyConsole</pre>
</div>
</div>
<div class="paragraph">
<p>If the console is started we see the following GUI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/groovy-console.png" alt="groovy console">
</div>
</div>
<div class="paragraph">
<p>At the top we can type in code and execute it using <code>Script | Run</code>. Type in the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">System.out.println('Heroes');</code></pre>
</div>
</div>
<div class="paragraph">
<p>and execute it the code via <code>Script | Run</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To execute a script we can also the shortcut key combination <code>Ctrl+R</code> for Windows/Linux and <code>Cmd+R</code> for OSX.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that in the bottom part of the console we see the output.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/groovy-console-println.png" alt="groovy console println">
</div>
</div>
<div class="sect2">
<h3 id="_simpler_java">Simpler Java</h3>
<div class="paragraph">
<p>One of the interesting aspects of Groovy is that the syntax is closely related to the Java syntax. We can even write Java code in a Groovy class and it works. But with Groovy we have more options with the syntax. A lot of things are optional that are required in Java syntax.</p>
</div>
<div class="paragraph">
<p>In Groovy we can omit the <code>;</code> at the end of a line.</p>
</div>
<div class="paragraph">
<p>Groovy implicitly imports the following packages in our classes and scripts, so we don&#8217;t have to define them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.io.*
java.lang.*
java.math.BigDecimal
java.math.BigInteger
java.net.*
java.util.*
groovy.lang.*
groovy.util.*</pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t define an access modifier the <code>public</code> modifier is used.</p>
</div>
<div class="paragraph">
<p>The <code>return</code> keyword is optional for methods. The last statement of the method is automatically the return value. Groovy even can do type conversion based on the return type.</p>
</div>
<div class="paragraph">
<p>Also we don&#8217;t have to write <code>get</code> and <code>set</code> methods for properties ourselves in the code. Groovy will automatically generate a <code>get</code> and <code>set</code> method for properties without any access modifier in our code.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see all this in action. First we see a Java source file with some methods and properties. We can paste the source into our Grails console window and then run the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.jdriven.grails;

import java.util.Date;
import java.text.SimpleDateFormat;

public class JavaApp {

    private String name;
    private int version;

    public void setName(final String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setVersion(final int version) {
        this.version = version;
    }

    public int getVersion() {
        return version;
    }

    public String getDisplayName() {
        return getName() + " (" + getVersion() + ")";
    }

    public static void main(String[] args) {
        final JavaApp app = new JavaApp();
        app.setName("JavaApplication");
        app.setVersion(1);

        final SimpleDateFormat dateFormatter = new SimpleDateFormat("dd-MM");
        final String formattedDate = dateFormatter.format(new Date());

        System.out.println("Running JavaApp "
            + app.getDisplayName() + " on " + formattedDate);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change this into a Groovy version we can use the following code. Copy and paste the source in the console window and run it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package com.jdriven.grails

class GroovyApp {
    String name
    int version

    String getDisplayName() {
        "$name ($version)"
    }
}

final GroovyApp app = new GroovyApp(name: 'GroovyApp')
app.version = 1 // Or app.setVersion(1)

println "Running GroovyApp ${app.displayName} on ${new Date().format('dd-MM')}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice we can leave out parentheses, semi-colons (<code>;</code>) and the <code>return</code> keyword.
Also to assign a value to a property we use the equal sign (<code>=</code>), which translates to a <code>set</code> method on the object. We use dot (<code>.</code>) to get value for property, which is short for using a <code>get</code> method.
Also we notice a different way to work with String values. We will look at more String options in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_strings">Strings</h3>
<div class="paragraph">
<p>In Java we define a string value enclosed in double quotes and a character type enclosed in single quotes. In Groovy we can define string enclosed in single quotes as well or even enclosed in slashes. So we have three different ways to define a string value in Groovy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">String singleQuotes = 'Groovy allows single quotes to create a string'

String doubleQuotes = "Groovy also allows double quotes, just like in Java"

// Useful for regular expression where \ can be used instead of escaped \\
String slashes = /And a third way to create a string/


println singleQuotes.class.name // Output: java.lang.String
println doubleQuotes.class.name // Output: java.lang.String
println slashes.class.name // Output: java.lang.String</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy also supports a more advanced string called a <code>GString</code>. A <code>GString</code> is just like a normal string, except that it evaluates expressions (text between <code>${</code> and <code>}</code>) which are embedded within the string. This is called 'interpolation'.</p>
</div>
<div class="paragraph">
<p>When Groovy sees a string defined with double quotes or slashes and an embedded expression, Groovy constructs an <code>org.codehaus.groovy.runtime.GStringImpl</code>. When the <code>GString</code> is accessed, the expression is evaluated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">String company = 'JDriven'
String message = "${company} - Grails workshop"

println message // Output: JDriven - Grails workshop

String convert = /Welcome to '${company.toLowerCase()}'/

println convert // Output: Welcome to 'JDriven'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we can write multi-line String values in Groovy. We must enclose the string value in three single or double quotes. This can be useful to define for example SQL queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">String tableName = 'Groovy'
String sql = """
select count(*) from ${tableName}
where id &gt; 100
"""

runQuery sql

void runQuery(String sql) {
   println "Running the following query:"
   println sql
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_typing">Dynamic typing</h3>
<div class="paragraph">
<p>One of the features of Groovy is that it is a dynamic language. Groovy supports dynamic typing. This means we don&#8217;t define the type of a variable up front, but let the context decide the type of the variable. So at run-time the type of the variable is known, but doesn&#8217;t have to be known at edit or compile time.</p>
</div>
<div class="paragraph">
<p>Dynamic typing in Groovy still means variables do have a type at a certain point in time. The variable is strongly typed, because if we misuse the type in our code we get an exception at run-time.</p>
</div>
<div class="paragraph">
<p>We use the <code>def</code> keyword to define a variable without a certain type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">Integer intValue = 42
def dynamicValue = 42

// Static type
println intValue.class.name // Output: java.lang.Integer

// Dynamic, strong type
println dynamicValue.class.name // Output: java.lang.Integer


try {
   intValue = true  // Class cast exception.
} catch (Exception e) {
   println "ClassCastException: ${e.message}"
}

// We can reassign a dynamic type.
dynamicValue = true

println dynamicValue.class.name // Output: java.lang.Boolean

try {
   dynamicValue.length()  // Invalid method for Boolean type.
} catch (Exception e) {
   println "Exception: ${e.message}"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closures">Closures</h3>
<div class="paragraph">
<p>Closures look a lot like methods, because we can pass parameters and we get a return value. But closures are anonymous. A closure is a piece of code that can be assigned to a variable. Later we can execute the code. Since Java 8 Java has lambda expressions which look a lot like Groovy closures.</p>
</div>
<div class="paragraph">
<p>A closure in Groovy is ultimately compiled to a <code>groovy.lang.Closure</code> object. We can even use this type when we define a variable and assign a closure to it. We can invoke a closure just like a method and use the return value, but we can also use the <code>call()</code> method of a closure to invoke it.</p>
</div>
<div class="paragraph">
<p>If we define a closure in Groovy we can define our own arguments or rely on the default argument <code>it</code> for a single argument closure. The <code>it</code> argument is available if we don&#8217;t define any named arguments ourselves. We can also create a closure and define it to have no arguments even not the <code>it</code> argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def minusOne = { value -&gt;
    value - 1
}

// A closure with only one argument
// can use the variable name it:
// def minusOne = { it - 1 }

def result = minusOne('Groovy string 1')  // Invoke closure.

println result // Output: Groovy string
               // (Groovy adds a minus() method to the String class,
               // which will remove the given String value from the original String.
               // The minus() method maps to the - operator)
println minusOne(44) // Output: 43 (numeric subtraction)
println minusOne.call('10') // Output: '0' (remove String value from original String)

Closure timesTwo = { value -&gt;
    value * 2
}
result = timesTwo('Groovy')

println result // Output: 'GroovyGroovy'
               // (Groovy adds a times() method to the String class,
               // and the times() method maps to the * operator)
println timesTwo(2) // Output: 4

def add = { a, b -&gt;
    a + b
}
println add('Groovy ', 'Java') // Output: 'Groovy Java'
println add(10, 1) // Output: 11

def noArgs = { -&gt;
    'Closure without arguments.'
}
println noArgs() // Output: 'Closure without arguments.'</code></pre>
</div>
</div>
<div class="paragraph">
<p>We saw closures are just blocks of code we can assign to a variable and execute. But this also means we can use closures as method parameters. Groovy has some variations we can use to pass a closure into a method. If for example the closure is the last argument for a method we can put the closure outside the argument list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def printValue = { String value -&gt;
    println "Hello ${value}"
}

// Define method
void greet(final String name, Closure print) {
    print(name) // Or: print.call(name)
}

// Invoke method with closure.
greet('Developers', printValue)
// Output: Hello Developers

// Use 'anonymous closure'.
greet('JDriven', { value -&gt; println "G'day ${value}" })
// Output: G'day JDriven

// Special syntax for last argument closure
greet('Heroes') { value -&gt;
    println "Amazing ${value}"
}
// Output: Amazing Heroes</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collections">Collections</h3>
<div class="paragraph">
<p>Working with collections is very common in every day programming. Groovy makes working with collections very easy, by providing a concise syntax and by adding new functionality.</p>
</div>
<div class="sect3">
<h4 id="_ranges">Ranges</h4>
<div class="paragraph">
<p>Ranges are lists with sequential values. Each range is also a list object, because Range extends <code>java.util.List</code>. A range can be inclusive (so both begin and end values are in the range) or exclusive (the end value is not in the range). We use <code>..</code> for an inclusive range and <code>..&lt;</code> for an exclusive range.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">  // Simple ranges with number values.
 def ints = 1..10
 println ints // Output: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 println ints.size() // Output: 10
 println ints.from // Output: 1
 println ints.to // Output:  10

 // A range is just a List.
 println ints[1] // Output: 2
 println ints.last() // Output: 10

 // Exclusive range.
 def exclusive = 2..&lt;8
 println exclusive // Output: [2, 3, 4, 5, 6, 7]
 println exclusive.size() // Output: 6
 println !exclusive.contains(8) // Output: true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lists">Lists</h4>
<div class="paragraph">
<p>Defining a list in Groovy looks like defining an array. We use square brackets to define a new list. The list is of type <code>java.util.ArrayList</code>. It is very easy to create a list this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def empty = []
println empty.class.name // Output: java.util.ArrayList

class User {
      String username
      String toString() { username }
}
def student = new User(username: 'student')

def items = ['Groovy', 12, student]
println items.size() // Output: 3

// Negative index to read from last to first.
println items[-2] // Output: 12

println items.reverse() // Output: [student, 12, Groovy]

// Adding items with the leftShift operator.
items &lt;&lt; 'Grails'
println items // Output: [Groovy, 12, student, Grails]

println items + [1, 2] // Output: [Groovy, 12, student, Grails, 1, 2]
println items - [student, 12] // Output: [Groovy, Grails]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maps">Maps</h4>
<div class="paragraph">
<p>Maps are defined by a list of keys and values. The key is a string by default, but we can use any type we want for the key. We can even use variables as keys for our map. We only have to place parentheses around the key to make it work. This way we can use variables and types like <code>Date</code> and <code>Boolean</code> as keys for our map. When we use parentheses around the key when using the <code>.</code> notation the key is converted to a <code>String</code>, otherwise the key is not converted and keeps it type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def empty = [:]
println empty.getClass().name // Output: java.util.LinkedHashMap

// Simple map.
def m = [name: 'student', language: 'Groovy']

println m.getAt('name') // Output: 'student'
println m['name'] // Output: 'student'
println m.language // Output: 'Groovy'
println m."name" // Output: 'student'

// We can omit the default value if we know the key exists.
println m.get('name')  // Output: 'student'
println m.get('language', 'Java')// Output: 'Groovy'

// Use default value, this also creates the key/value pair in the map.
println m.get('expression', 'rocks')  // Output: 'rocks'

println m // Output: [name: 'student', language: 'Groovy', expression: 'rocks']</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_collection_methods">Collection methods</h4>
<div class="paragraph">
<p>Groovy adds a lot of extra methods to the <code>Collection</code> API classes. For example to loop through a collection we can use the <code>each()</code> method with a closure. The closure is then invoked for each element in the collection.
Or we can transform elements with the <code>collect()</code> method. We define the transformation with a closure that is executed for each element. Finally we can search for elements with a couple of <code>find()</code> and <code>findAll()</code> methods. We define a conditional expression in a closure and if the result is true the element will be included in the filtered result collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def list = ['ABC', 'DEF', 'GHIJ']

// Print each element.
list.each { println it }
// Output:
// ABC
// DEF
// GHIJ

// Transform elements.
def itemSizes = list.collect { value -&gt;
	value.size()
}
println itemSizes // Output: [3, 3, 4]

// Filter elements.
def sizeThree = itemSizes.findAll { it == 3 }
println sizeThree // Output: [3, 3]

// Sort elements.
def sorted = list.toSorted { value -&gt;
	value[2] // Sort on last letter
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have now seen enough of Groovy to create our web application in Grails. We can close the GroovyConsole window and we return to the command-line.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_scaffolding" class="sect0">Scaffolding<a id="scaffolding"></a></h1>
<div class="openblock partintro">
<div class="content">
In our superhero application we must be able to enter data about villains and the data must be stored in a database, so we can retrieve the information again. We need some screens where we can create a new villain, change data about an existing villain and we must be able to delete the information about the villain. In this lab we will create those screens and define a domain class to store the information in the database.
</div>
</div>
<div class="sect1">
<h2 id="_create_a_domain_class">Create a domain class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In our application we want to keep track of villains. We need some model to store information about villains, so later we can lookup the information quickly. First we create a domain class <code>Villain</code> with the command <code>create-domain-class</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails create-domain-class heroes.Villain
...
| Created grails-app/domain/heroes/Villain.groovy
| Created src/test/groovy/heroes/VillainSpec.groovy
&gt;</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of starting Grails for each command we can also start the Grails interactive shell. To start the interactive shell we simply type <code>grails</code> and press <code>Enter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails
grails&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>From the command prompt we can execute Grails command. We even get code completion by pressing the <code>Tab</code> key. So to create the domain class <code>Villain</code> from the Grails command prompt we type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grails&gt; create-domain-class heroes.Villain
...
| Created grails-app/domain/heroes/Villain.groovy
| Created src/test/groovy/heroes/VillainSpec.groovy
grails&gt;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output already shows where the source of the domain class is created: <code>grails-app/domain/heroes/Villain.groovy</code>. Also notice the skeleton for a test class is generated at <code>test/unit/heroes/VillainSpec.groovy</code>. We will look at testing later.</p>
</div>
<div class="paragraph">
<p>Grails expects domain classes to be in the directory <code>grails-app/domain</code>. The name of the package is <code>heroes</code>. We can change this either through configuration or we specify a complete package name when we use the <code>create-domain-class</code> command like we did.</p>
</div>
<div class="paragraph">
<p>If we open the file in our IDE or text editor we see the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Villain {

    static constraints = {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s implement the domain class and add some properties and constraints to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Villain {

    String name
    String alias
    Date firstAppearance

    static constraints = {
        name(nullable: false, blank: false, maxSize: 100)
        alias(nullable: true, maxSize: 100)
        firstAppearance()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties we have defined will be mapped to columns names in a table in a database. The persistence mechanism used by Grails is based on Hibernate. We can change this if we want for example to use a NoSQL implementation, but we stick here to the default Hibernate implementation. The object relational mapping is called GORM (Grails Object Relation Mapping). GORM adds a lot of useful methods to classes and objects to work with data. We will see some of these methods later in the workshop.</p>
</div>
<div class="paragraph">
<p>The <code>constraints</code> section is used by Grails to validate user input when data is saved or validation is explicitly invoked. If we come from a Java background this might looks strange at first, but remember that <code>constraints</code> is a static variable in our class with a closure as value. Grails uses this information to be able to facilitate validation of the data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_controller">Creating the controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grails uses Spring Model-View-Controller (MVC) and adds an extra convenient layer on top of it. So let&#8217;s create a controller for our <code>Villain</code> so we use our web browser to work with <code>Villain</code> data with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails create-scaffold-controller heroes.Villain
| Rendered template ScaffoldedController.groovy to destination grails-app/controllers/heroes/VillainController.groovy
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Like with domain classes, Grails wants the source of code of controllers to be in a specific directory: <code>grails-app/controllers</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What is scaffolding?</p>
</div>
<div class="paragraph">
<p>Scaffolding auto generates some basic CRUD (Create/Read/Update/Delete) operations for a domain class. This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Controller actions for create/read/update/delete (CRUD) operations</p>
</li>
<li>
<p>The necessary views</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read more about scaffolding at <a href="https://grails.org/doc/latest/guide/single.html#scaffolding">Scaffolding</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class VillainController {

    static scaffold = Villain

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see the result of the scaffolding in our application. We must start (or restart) the application and open the url <code><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></code> in our browser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails run-app
| Grails application running at http://localhost:8080 in environment: development
&gt;</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If we are using the interactive shell we can stop the application with the <code>stop-app</code> command.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Grails supports hot reloading of a lot code in the application. This means we don&#8217;t have to stop and start the application often. We simply change a source file and hit the Refresh button in our browser to see the changes. But sometimes Grails can&#8217;t keep track of a change and then we really need to restart the application to see the change.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/scaffold-start.png" alt="scaffold start">
</div>
</div>
<div class="paragraph">
<p>If we click on the <code>VillainController</code> link we can start to play around with scaffolding. We can create a new villain, update the data and see an overview of all villains. The columns of the overview table are also sortable.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/scaffold-sample.png" alt="scaffold sample">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise">Exercise</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new domain class <code>Species</code></p>
</li>
<li>
<p>Add a new <code>String</code> property <code>name</code></p>
</li>
<li>
<p>Implement a <code>toString()</code> method which will return the <code>name</code> property</p>
</li>
<li>
<p>Create a new scaffold controller for this domain class</p>
</li>
<li>
<p>Try it out in a running application</p>
</li>
</ol>
</div>
</div>
</div>
<h1 id="_relationships_and_constraints" class="sect0">Relationships and constraints<a id="relations"></a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>We have seen in the previous lab that we could define constraints in a domain class. In this lab we are going to see the constraints in more details and we will define another domain class and relate the three domain classes to each other.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look a bit closer to these constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Villain {

    String name
    String alias
    Date firstAppearance

    static constraints = {
        name(nullable: false, blank: false, maxSize: 100)
        alias(nullable: true, maxSize: 100)
        firstAppearance()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>constraints</code> closure we define the name of the property followed by several validation rules. If a property only has default validation rules we can leave it out or just use the name of the property. A property can have more than one validation constraints and they are separated by a comma.</p>
</div>
<div class="paragraph">
<p>Grails has a lot of constraints available we can use directly in our code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nullable</code>: indicate if the value may be <code>null</code> or not. This makes a property required or not.</p>
</li>
<li>
<p><code>blank</code>: for <code>String</code> properties to check if the value is blank. A value with only spaces is rejected if <code>blank</code> is <code>false</code>.</p>
</li>
<li>
<p><code>maxSize</code>, <code>minSize</code>: limit the size of the property.</p>
</li>
<li>
<p><code>email</code>, <code>url</code>, <code>creditCard</code>: checks the format of a property.</p>
</li>
<li>
<p><code>validator</code>: allows to set a custom constraint for a property. Here we can write our own constraint implementation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information see <a href="https://grails.org/doc/latest/ref/Constraints/Usage.html">Constraints Usage</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of the properties defined in the <code>constraints</code> section also dictates the order on the web form with scaffolding.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relationships">Relationships</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We now have two domain classes that are not related to each other yet. But we want the have a property <code>species</code> of type <code>Species</code> in our <code>Villain</code> class. Also we add a new domain class <code>Encounter</code> to our application. This is to keep track of encounters we as superheroes have with the specific villain. So the domain class are related as shown in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/relation-diagram.png" alt="relation diagram">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Villain {

    String name
    String alias
    Date firstAppearance

    Species species

    static hasMany = [encounters: Encounter]

    static constraints = {
        name(nullable: false, blank: false, maxSize: 100)
        alias(nullable: true, maxSize: 100)
        firstAppearance()
    }

    String toString() {
        name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>hasMany</code> variable we can define a one-to-many relationship in our code. We set the name and type of the relationship as a <code>Map</code>. If we want to have cascading behavior in a one-to-many relationship we must also specify a <code>belongsTo</code> property to the owner object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Encounter {

    String location
    Date when

    static belongsTo = [villain: Villain]

    static constraints = {
        location(nullable: false, blank: false, maxSize: 100)
        when()
    }

    String toString() {
        location
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>hasMany</code> variable we can define a one-to-many relationship in our code. We set the name and type of the relationship as a <code>Map</code>. If we want to have cascading behavior in a one-to-many relationship we must also specify a <code>belongsTo</code> property to the
owner object. For example if we delete a villain we also now delete all encounters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class EncounterController {

    static scaffold = Encounter

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can restart our application to see new relationships in action:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/relations.png" alt="relations">
</div>
</div>
<div class="paragraph">
<p>We can add first a species and encounters. Then we can use them when we create a new villain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default scaffolding is very basic. This means an object with relations can only be saved if the relations are already there. So we have to switch between screens to first enter an encounter and species, before saving a new villain.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration<a id="configuration"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Until now when we restarted the application all data we entered was gone. Any species, villain or encounter we have entered is not available anymore when we restart the application. We will see how we can change our configuration so the data is persisted more permanently. Also we are going to take a look how we can use Grails bootstrapping to initialize data when the application starts.</p>
</div>
<div class="sect2">
<h3 id="_datasource">Datasource</h3>
<div class="paragraph">
<p>By default Grails uses an in-memory <a href="http://www.h2database.com/html/main.html">H2 database</a> to store the data. So each time we restart the application the data is removed from memory and the database is clear when we start the application. Let&#8217;s change our database configuration, so the data will be persisted to a file on our local computer.</p>
</div>
<div class="paragraph">
<p>The files with the configuration of a Grails application can be found in the <code>grails-app/conf</code> directory of our project. In the file <code>application.yml</code> we find the configuration for our database. Notice there is a line that stars with <code>environments</code> and is followed by a block of code containing the key words <code>development</code>, <code>test</code> and <code>production</code>. Out of the box Grails supports three environments with different configuration options. We can (re)define configuration properties for each environment. The configuration values for the <code>production</code> environment are used when we create a WAR file of our project, the <code>test</code> options are used when run Grails tests. The <code>development</code> environment is used when simply run our application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can also add our own environment to the configuration files in Grails. To use a new environment we must add the option <code>-Dgrails.env=&lt;configurationName&gt;</code> to the <code>grails</code> command. For example if we created a new environment <code>acceptance</code> we would run our application with <code>&gt; grails -Dgrails.env=acceptance run-app</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To save the data we enter in the application to a file, we must change the configuration in the <code>development</code> section of <code>environments</code>. We use a different <code>dataSource.url</code> to create a file <code>db/devDb</code> to store the data and change <code>dataSource.dbCreate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">environments:
    development:
        dataSource:
            dbCreate: update
            url: jdbc:h2:file:db/devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is time to start our application and enter some data. If we stop the application and start it again we will still have our preciously entered data. More information about configuring a datasource in <a href="https://grails.org/doc/latest/guide/conf.html#dataSource">Datasource reference</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get an inside view of the database we can open the URL <a href="http://localhost:8080/dbconsole" class="bare">http://localhost:8080/dbconsole</a>. Enter the proper datasource URL and use as username <code>sa</code> and leave the password field empty:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/dbconsole-init.png" alt="dbconsole init">
</div>
</div>
<div class="paragraph">
<p>Click on the Connect button to connect to the database. If everything is successful we get an overview of the database tables and we can select data or even run custom SQL from our browser to update data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/dbconsole.png" alt="dbconsole">
</div>
</div>
<div class="paragraph">
<p>This URL is not available when the application runs in production environment or inside the WAR file of the application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can use the Database Migration plugin to use SQL scripts and/or Groovy code to manage database changes. The plugin uses Liquibase under the hood.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bootstrapping">Bootstrapping</h3>
<div class="paragraph">
<p>In the <code>grails-app/init</code> directory we also see the file <code>Bootstrap.groovy</code>. In this file we can write code that will be executed each time the application is started and stopped. For example we can create initial database content or define data for test purposes.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add some villains and species in <code>Bootstrap.groovy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import heroes.Species
import heroes.Villain

class BootStrap {

    def init = { servletContext -&gt;
        log.debug('loading Bootstrap')

        Species human = Species.findByName('Human')
        if (!human) {
            human = new Species(name: 'Human').save()
        }

        final Villain syndrome = Villain.findByName('Syndrome')
        if (!syndrome) {
            syndrome = new Villain(
                            name: 'Syndrome',
                            alias: 'Buddy Pine',
                            firstAppearance: Date.parse('dd-MM-yyyy', '01-05-2004'),
                            species: human)
            syndrome.addToEncounters(
                    location: 'Tropical Island',
                    when: Date.parse('dd-MM-yyyy', '13-07-2004'))
            syndrome.save()
        }

        Species lego = Species.findByName('Lego')
        if (!lego) {
            lego = new Species(name: 'Lego').save()
        }

        if (!Villain.findByName('Lord Business')) {
            final Villain lordBusiness =
                    new Villain(
                            name: 'Lord Business',
                            alias: 'President Business',
                            firstAppearance: Date.parse('dd-MM-yyyy', '01-02-2014'),
                            species: lego)
            lordBusiness.addToEncounters(
                    location: 'Desert',
                    when: Date.parse('dd-MM-yyyy', '02-02-2014'))
            lordBusiness.addToEncounters(
                    location: 'Police station',
                    when: Date.parse('dd-MM-yyyy', '12-02-2014'))
            lordBusiness.save()
        }
    }

    def destroy = {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we start our application we can now see the data is available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging">Logging</h3>
<div class="paragraph">
<p>If we want to add some logging to our code we can simply use <code>println</code> and we see the output in our console or command prompt window. But it is better to use the built-in logging of Grails. Grails uses the Logback logging library to add logging support to an application. We configure our the logging in <code>grails-app/conf/logback.groovy</code>.  More information can be in found in <a href="https://grails.org/doc/latest/guide/conf.html#logging">Logging reference</a>.</p>
</div>
<div class="paragraph">
<p>Grails uses Groovy AST transformations to add a <code>log</code> variable to all Grails artifacts, like controllers and services.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add the lines that start with <code>logger</code>. Now when we use the Grails logging like <code>log.debug('sample')</code> we can see the output in our console or command prompt window.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import grails.util.BuildSettings
import grails.util.Environment

// See http://logback.qos.ch/manual/groovy.html for details on configuration
appender('STDOUT', ConsoleAppender) {
    encoder(PatternLayoutEncoder) {
        pattern = "%level %logger - %msg%n"
    }
}

logger('grails.app.init', DEBUG)
logger('grails.app.controllers.heroes', DEBUG)
logger('grails.app.services.heroes', DEBUG)
logger('grails.app.domain.heroes', DEBUG)
logger('heroes', DEBUG)

root(ERROR, ['STDOUT'])

def targetDir = BuildSettings.TARGET_DIR
if (Environment.isDevelopmentMode() &amp;&amp; targetDir) {
    appender("FULL_STACKTRACE", FileAppender) {
        file = "${targetDir}/stacktrace.log"
        append = true
        encoder(PatternLayoutEncoder) {
            pattern = "%level %logger - %msg%n"
        }
    }
    logger("StackTrace", ERROR, ['FULL_STACKTRACE'], false)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a logging statement in the <code>Bootstrap.groovy</code> file. We restart our application to load the changed logging configuration. In the output we see our logging statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grails&gt; run-app
| Running application...
DEBUG grails.app.init.BootStrap - loading Bootstrap
Grails application running at http://localhost:8080 in environment: development</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_views_and_controllers">Views and controllers<a id="views-controllers"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have relied on default scaffolding to create the screens in our application. Let&#8217;s create our own controller and view in this lab.</p>
</div>
<div class="paragraph">
<p>We want to have a navigation menu in our application that lists all species. If we click on the species name we must see a list of all villains of that specific species.</p>
</div>
<div class="paragraph">
<p>Grails has a Model-View-Controller (MVC) architecture based on Spring MVC. In the controller we write logic to handle requests, invoke business logic in the application and make sure a model is built that can be used in a view. The data in the model can be accessed in the view. For our new navigation menu we must do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The controller gets the list of species from the database.</p>
</li>
<li>
<p>The list is put in a <code>Map</code>, which will be the model.</p>
</li>
<li>
<p>The view gets the result from the model and renders a list with species names and links.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_building_the_controller">Building the controller</h3>
<div class="paragraph">
<p>First we implement the controller. We will add a new method <code>allSpecies</code> to our existing controller <code>grails-app/controllers/heroes/SpeciesController.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class SpeciesController {

    static scaffold = Species

    def allSpecies() {
        [allSpecies: Species.list()]
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice we can add methods to a controller where scaffolding is enabled. These methods are additional to the methods that are added by the scaffolding.</p>
</div>
<div class="paragraph">
<p>We use the <code>list</code> method of the <code>Species</code> class. As we might remember we haven&#8217;t written this method ourselves. We have only defined a domain class <code>Species</code>. Grails adds a lot of dynamic methods to domain classes to search and find data of the domain class. More information about methods that are added can be seen at <a href="https://grails.org/doc/latest/ref/Domain%20Classes/Usage.html">domain class usage</a> (check out right navigation bar).</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_the_view">Building the view</h3>
<div class="paragraph">
<p>The method <code>allSpecies</code> we added in the controller returns a <code>Map</code> with one key <code>allSpecies</code> as the model. We didn&#8217;t specify the name of the view. Grails will by default use the name of action as the name of the view with the following pattern <code>grails-app/views/&lt;controllerName&gt;/&lt;actionName&gt;.gsp</code>. So for our <code>allSpecies</code> action the view <code>grails-app/views/species/allSpecies.gsp</code> is expected by Grails. More information about <a href="https://grails.org/doc/latest/guide/theWebLayer.html#gsp">Groovy Server Pages</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;%@ page contentType="text/html;charset=UTF-8" %&gt;
&lt;h2&gt;Species&lt;/h2&gt;

&lt;ul&gt;
    &lt;g:each in="${allSpecies}" var="species"&gt;
        &lt;li&gt;
            &lt;g:link controller="villain"
                    action="index"
                    params="[species: species.id]"&gt;${species.name}&lt;/g:link&gt;
        &lt;/li&gt;
    &lt;/g:each&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A view in Grails is defined as Groovy Server Page (GSP), which is similar like Java Server Page (JSP). We define the HTML in a GSP and we can use GSP custom tags to generate output. In the <code>allSpecies.gsp</code> we use two GSP tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;g:each/&gt;</code> iterate over a collection of objects. The body of the tag is executed for each element. We can use expressions enclosed in <code>${&#8230;&#8203;}</code> to access the element, or we can use other tags and HTML content as well.</p>
</li>
<li>
<p><code>&lt;g:link/&gt;</code> creates a link to another controller and action. We don&#8217;t have to hard code the URL, we only have to specify the controller and action as attributes of the tag, Grails will create the valid link to this controller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are just a couple of the tags available to us. Grails has a lot more tags we can use. For more information about the available tags we can see <a href="https://grails.org/doc/latest/ref/Tags/each.html">Grails tags</a> (see the right navigation section Tags).</p>
</div>
<div class="paragraph">
<p>Later we see how we can write our own tag.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s check out the result of our coding. We must start the application and browse to <a href="http://localhost:8080/species/allSpecies" class="bare">http://localhost:8080/species/allSpecies</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/allspecies.png" alt="allspecies">
</div>
</div>
<div class="paragraph">
<p>We see now a list of species that are available. If we click on the link we go to the villain overview page. We see an overview of all villains, but we will make sure only the villains of the selected species will be shown in the next step.</p>
</div>
<div class="paragraph">
<p>By convention Grails uses a pattern to map controllers and actions to URLs in the application. The default mapping is <code>/&lt;controllerName&gt;/&lt;actionName&gt;/&lt;optional identifier parameter and extension&gt;</code>. This is defined in the file <code>grails-app/controllers/UrlMappings.groovy</code>. We can create or change the mapping of URLs to controller and actions here. The rules defined in <code>UrlMappings.groovy</code> are also used to create the link by the <code>&lt;g:link/&gt;</code> tag. More <a href="https://grails.org/doc/latest/guide/theWebLayer.html#urlmappings">information about URL mappings</a> is available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_views_and_controllers">Generating views and controllers</h3>
<div class="paragraph">
<p>We now want to change the <code>index</code> action of the <code>VillainController</code> so we can filter on a selected species. The <code>index</code> action is a method that is defined by the scaffolding. We will generate now the complete source code for the scaffolding, so we can make adjustments ourselves.</p>
</div>
<div class="paragraph">
<p>To generate the view and controller for the <code>Villain</code> we use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails generate-all heroes.Villain --force
| Rendered template Controller.groovy to destination grails-app/controllers/heroes/VillainController.groovy
| Rendered template Spec.groovy to destination src/test/groovy/heroes/VillainControllerSpec.groovy
| Rendered template edit.gsp to destination grails-app/views/villain/edit.gsp
| Rendered template create.gsp to destination grails-app/views/villain/create.gsp
| Rendered template index.gsp to destination grails-app/views/villain/index.gsp
| Rendered template show.gsp to destination grails-app/views/villain/show.gsp
| Scaffolding completed for grails-app/domain/heroes/Villain.groovy
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>We have generated a controller instead of creating a controller as we did before. With the <code>create-controller</code> command a new empty controller class is created and with <code>generate-all</code> a new controller class complete with implementations for default actions, like <code>create</code>, <code>update</code> together with all the views.</p>
</div>
<div class="paragraph">
<p>If we run the application after we have generated the view and controller the functionality should still be the same. Only now all the scaffolding code is available as source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
class VillainController {
    ...
    def index(Integer max) {
        params.max = Math.min(max ?: 10, 100)
        if (params.species) {
            final Species species = Species.get(params.species)
            log.debug("Filter list of villains with species ${species.name}")
            respond Villain.findAllBySpecies(species, params),
                    model: [villainCount: Villain.countBySpecies(species)]
        } else {
            respond Villain.list(params), model: [villainCount: Villain.count()]
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>params</code> variable is a dynamic property of a controller that is added by Grails. It contains a map of the request parameters used to invoke the controller action. <a href="https://grails.org/doc/latest/guide/theWebLayer.html#controllersAndScopes">More information</a> about extra properties is available.</p>
</div>
<div class="paragraph">
<p>The methods <code>findAllBySpecies</code> and <code>countBySpecies</code> are so-called dynamic finders. This is where a lot of the dynamic nature of Groovy is used by Grails to allows us to write less code to achieve a lot. Dynamic finders follow a pattern combined of a search method and properties of the domain class. For example the following code shows some sample dynamic finders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">// Find single domain with findBy...
final evilVillain = Villain.findByAliasLike('%evil%')

// Find multiple results with findAllBy...
final startOfYear = Date.parse('dd-MM-yyyy', '01-01-2013')
final endOfYear = Date.parse('dd-MM-yyyy', '31-12-2013')
final allFirstAppearance2013 = Villain.findAllByFirstAppearanceBetween(startOfYear, endOfYear)

// Combine properties
final reallyEvil = Villain.findAllByNameILikeAndAliasILike('%evil%', '%evil%')</code></pre>
</div>
</div>
<div class="paragraph">
<p>More complex querying is also possible using Hibernate criteria or Hibernate Query Language (HQL). See the <a href="https://grails.org/doc/latest/guide/GORM.html#querying">documentation</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_tag">Custom tag</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writing a custom tag in Grails is simple compared to writing a custom tag in JEE. We can invoke the <code>create-taglib</code> command to start writing our own tag implementation. Let&#8217;s write a simple tag that will print out a simple text and date.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails create-taglib heroes.Copyright
| Created file grails-app/taglib/heroes/CopyrightTagLib.groovy
| Created src/test/groovy/heroes/CopyrightTagLibSpec.groovy
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>We add a new tag as a closure property in the <code>CopyrightTagLib.groovy</code>. The closure accepts two arguments: <code>attributes</code> and <code>body</code>. Attributes can be defined for the tag and used in the implementation. The <code>body</code> contains everything between start and end tags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class CopyrightTagLib {

    static defaultEncodeAs = [taglib:'html']
    //static encodeAsForTags = [tagName: [taglib:'html'], otherTagName: [taglib:'none']]

    static namespace = 'heroes'

    def copyright = { attributes, body -&gt;
        // Get format for date from attributes,
        // if not set use default 'dd-MM-yyyy'.
        final String format = attributes.format ?: 'dd-MM-yyyy'
        out &lt;&lt; "Heroes to the rescue! Also in ${new Date().format(format)}"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use this tag in our GSP we can simply add <code>&lt;heroes:copyright/&gt;</code> to a view. The static <code>namespace</code> variable defines the name as we can use it in a GSP.</p>
</div>
<div class="sect2">
<h3 id="_i18n">i18n</h3>
<div class="paragraph">
<p>Internationalization (i18n) is supported by the underlying Spring framework. In our views and controllers we can use the <code>&lt;g:message/&gt;</code> tag. With the <code>code</code> attribute of this tag we can give a value for a key that is used to lookup the correct value for the current locale of the user. The default implementation of Grails is to use the user&#8217;s locale as set by the web browser. We can override this and use other ways (like a user selection) to set the correct locale.</p>
</div>
<div class="paragraph">
<p>The messages for the keys can be found in Java property files in the directory <code>grails-app/i18n</code>. The filename includes the locale, so Grails knows which file to use.</p>
</div>
<div class="paragraph">
<p>The following implementation of our copyright tag uses the <code>message</code> tag with <code>code</code> value <code>tag.copyright.message</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Copyrighti18nTagLib {

    static defaultEncodeAs = [taglib:'html']
    //static encodeAsForTags = [tagName: [taglib:'html'], otherTagName: [taglib:'none']]

    static namespace = 'heroes'

    def copyright = { attributes, body -&gt;
        out &lt;&lt; "${g.message(code: 'tag.copyright.message', args: [new Date()])}"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the files <code>grails-app/i18n/messages_nl.properties</code> and <code>grails-app/i18n/messages.properties</code> we add the key 'tag.copyright.message':</p>
</div>
<div class="paragraph">
<p><code>grails-app/i18n/messages.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
tag.copyright.message = Heroes to the rescue! Also in {0,date}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>grails-app/i18n/messages_nl.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
tag.copyright.message = Redding door de helden! Ook in {0,date}
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To test the different locales we can add the request parameter <code>lang</code> to our request. The value is a String representation of the locale. For example to get the Dutch locale we use <code>&lt;url&gt;?lang=nl</code> or the US locale <code>&lt;url&gt;?lang=en_US</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also change the labels for domain classes and their properties. The format we use is <code>domainClass.label</code> for the domain class label and <code>domainClass.property.label</code> for properties in a domain class. For example we can have Dutch labels for our <code>Species</code> class with the following key/value pairs:</p>
</div>
<div class="paragraph">
<p><code>grails-app/i18n/messages_nl.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">species.label = Soort
species.name.label = Naam</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_2">Exercise</h3>
<div class="ulist">
<ul>
<li>
<p>Add a new custom tag that will display the name of a <code>Species</code> identified by <code>params.species</code> on a page.</p>
</li>
<li>
<p>Use the new custom tag on the <code>index</code> view for <code>Villain</code> to show the name of the selected <code>Species</code>.</p>
</li>
<li>
<p>Write Dutch labels for the domain classes and their properties. Test with <code>&lt;url&gt;?lang=nl</code> to see results.</p>
</li>
<li>
<p>Open <a href="http://localhost:8080/species/allSpecies" class="bare">http://localhost:8080/species/allSpecies</a> and click on the links to see if the species name is shown.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_layout" class="sect0">Layout<a id="layout"></a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>As we play around with the application we notice each page has the same layout. There is the Grails logo at the top, some changing content like the list of villains or an edit page and the styling is the same. This happens because on each GSP we have the following lean in the <code>head</code> section of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;meta name="layout" content="main"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag tells Grails to format the GSP with the 'main' layout. A layout is a GSP that is stored in the <code>grails-app/views/layouts</code> directory. The 'main' layout maps to a <code>main.gsp</code> source. We can have multiple layouts in an application. In this lab we will add our species navigation we have created previously to the main layout.</p>
</div>
<div class="paragraph">
<p>The default <code>main.gsp</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!doctype html&gt;
&lt;html lang="en" class="no-js"&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
        &lt;title&gt;&lt;g:layoutTitle default="Grails"/&gt;&lt;/title&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
        &lt;asset:stylesheet src="application.css"/&gt;
        &lt;asset:javascript src="application.js"/&gt;

        &lt;g:layoutHead/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="grailsLogo" role="banner"&gt;&lt;a href="http://grails.org"&gt;&lt;asset:image src="grails_logo.png" alt="Grails"/&gt;&lt;/a&gt;&lt;/div&gt;
        &lt;g:layoutBody/&gt;
        &lt;div class="footer" role="contentinfo"&gt;&lt;/div&gt;
        &lt;div id="spinner" class="spinner" style="display:none;"&gt;&lt;g:message code="spinner.alt" default="Loading&amp;hellip;"/&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see a lot of HTML, but the most interesting tags are <code>&lt;g:layoutHead/&gt;</code> and <code>&lt;g:layoutBody/&gt;</code>. These tags will be replaced with the contents of the <code>head</code> and <code>body</code> section of the original GSP (that is using this template). The framework Sitemesh is used by Grails to achieve this.</p>
</div>
<div class="paragraph">
<p>To include our navigation menu with all species we include it in the <code>main.gsp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!doctype html&gt;
&lt;html lang="en" class="no-js"&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
        &lt;title&gt;&lt;g:layoutTitle default="Grails"/&gt;&lt;/title&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
        &lt;asset:stylesheet src="application.css"/&gt;
        &lt;asset:javascript src="application.js"/&gt;

        &lt;g:layoutHead/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="grailsLogo" role="banner"&gt;&lt;a href="http://grails.org"&gt;&lt;asset:image src="grails_logo.png" alt="Grails"/&gt;&lt;/a&gt;&lt;/div&gt;

        %{-- BEGIN: Added allSpecies navigation here. --}%
        &lt;div class="nav" role="navigation" id="speciesNav"&gt;
            &lt;g:include controller="species" action="allSpecies"/&gt;
        &lt;/div&gt;
        %{-- END: Added allSpecies navigation here. --}%

        &lt;g:layoutBody/&gt;
        &lt;div class="footer" role="contentinfo"&gt;&lt;/div&gt;
        &lt;div id="spinner" class="spinner" style="display:none;"&gt;&lt;g:message code="spinner.alt" default="Loading&amp;hellip;"/&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we run the application we should see the menu on each page. We will apply some extra styling later to make it look a bit different.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changing_the_index_page">Changing the index page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default index page if we browse to <a href="http://localhost:8080" class="bare">http://localhost:8080</a> shows a lot of technical information about our project. For our user we want a different view. The list of villains should be default page for our application. To achieve this we must change the <code>grails-app/controllers/UrlMappings.groovy</code> file. We remap the <code>"/"</code> URL, which is the home page, to the <code>VillainController</code> and <code>index</code> action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">class UrlMappings {

    static mappings = {
        "/$controller/$action?/$id?(.$format)?"{
            constraints {
                // apply constraints here
            }
        }

        "/"(controller: 'villain', action: 'index')

        "500"(view:'/error')
        "404"(view:'/notFound')
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_templates">Using templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If we have the same piece of GSP code we want to use in several places we can create a template for it. The template can then reused in other GSP views. The naming convention for a template in Grails is that the name starts with an underscore (<code>_</code>). Let&#8217;s create a template <code>_links.gsp</code> in the <code>grails-app/views/villain</code> directory with two links to the <code>index</code> action of the <code>EncounterController</code> and <code>SpeciesController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;li&gt;
    &lt;g:link controller="species" action="index" class="list"&gt;Species List&lt;/g:link&gt;
&lt;/li&gt;
&lt;li&gt;
    &lt;g:link controller="encounter" action="index" class="list"&gt;Encounters List&lt;/g:link&gt;
&lt;/li&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the template in a GSP we use the <code>render</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;g:render template="links"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add the template to the GSP views in <code>grails-app/views/villain</code>. Search for the section <code>&lt;div class="nav" role="navigation"&gt;</code> and after the last <code>li</code> element in the list add <code>&lt;g:render template="links"/&gt;</code>.</p>
</div>
<div class="paragraph">
<p>If we refresh the page in the application we now have two extra links on the page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_3">Exercise</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use the custom copyright tag we created in the previous lab and place it in the <code>&lt;div class="footer" role="contentinfo"&gt;&lt;/div&gt;</code>. The message should now be available on each page.</p>
</li>
<li>
<p>Add a CSS <code>list</code> class to the links in <code>grails-app/views/species/allSpecies.gsp</code>, so the links get an icon in front.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We should get the following layout:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/layout.png" alt="layout">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">Testing<a id="testing"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have written code, refreshed our browser window to see change and occasionally had to restart the application. But it is good practice to write tests for your code as well. Grails has good support for writing tests for our code.</p>
</div>
<div class="paragraph">
<p>Each time when we use a Grails command like <code>create-controller</code> to create a new class a corresponding test class is generated as well. Grails uses by default the <a href="http://spock-framework.org">Spock framework</a> for writing tests. The test source code can be found in <code>src/test/groovy</code> and <code>src/integration-test/groovy</code>.</p>
</div>
<div class="sect2">
<h3 id="_simple_unit_test">Simple unit test</h3>
<div class="paragraph">
<p>Let&#8217;s write a simple unit test implementation for the <code>Species</code> domain class. We will check the result of the <code>toString</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

import grails.test.mixin.TestFor
import spock.lang.Specification

/**
 * See the API for {@link grails.test.mixin.domain.DomainClassUnitTestMixin} for usage instructions
 */
@TestFor(Species)
class SpeciesSpec extends Specification {

    def setup() {
    }

    def cleanup() {
    }

    def "toString must return value for name property"() {
        given:
        final Species species = new Species(name: 'speciesName').save()

        expect:
        species.toString() == 'speciesName'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run our unit test we invoke the <code>test-app</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails test-app heroes.SpeciesSpec
...
BUILD SUCCESSFUL

Total time: 8.147 secs
| Tests PASSED
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To see the results we can open a generated HTML page. In our web browser we must then open <code>build/reports/test/index.html</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/test-result.png" alt="test result">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To open a test report we can also type <code>open test-report</code> from the Grails interactive shell.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_testing_controllers">Testing controllers</h3>
<div class="paragraph">
<p>To test controllers we can use the same testing framework. We can even mock domain classes. Grails will then use an in-memory map based GORM implementation. We can save and find data just like with a real database.</p>
</div>
<div class="paragraph">
<p>The following code tests the <code>allSpecies</code> method in the <code>SpeciesController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

import grails.test.mixin.Mock
import grails.test.mixin.TestFor
import spock.lang.Specification

/**
 * See the API for {@link grails.test.mixin.web.ControllerUnitTestMixin} for usage instructions
 */
@TestFor(SpeciesController)
@Mock([Species])
class SpeciesControllerSpec extends Specification {

    def setup() {
    }

    def cleanup() {
    }

    void "allSpecies must return a list of Species objects"() {
        given:
        new Species(name: 'species1').save()
        new Species(name: 'species2').save()

        when:
        def model = controller.allSpecies()

        then:
        model.allSpecies.size() == 2
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run our unit test we invoke the <code>test-app</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails test-app heroes.SpeciesControllerSpec
...
BUILD SUCCESSFUL

Total time: 8.099 secs
| Tests PASSED

&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Writing and running unit tests in Grails is very lightweight. If we want to integrate with a real database, or want to test custom SQL for example we must write an integration test. The source files are stored in <code>src/integration-test/groovy</code>. Grails will use the configuration from the <code>test</code> environment, like we learned in the lab about configuration.</p>
</div>
<div class="paragraph">
<p>To run an integration we use the <code>test-app</code> command. In this workshop we will not write an integration test, but it is good to know it exists.</p>
</div>
<div class="paragraph">
<p>More information about <a href="http://grails.org/doc/latest/guide/testing.html">testing</a>.</p>
</div>
</div>
</div>
</div>
<h1 id="_plugins" class="sect0">Plugins<a id="plugins"></a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Extending a Grails application with new functionality can be done by writing our own code, like we have done before. But Grails also has a plugin system that allows to easily add extra functionality to our application. Even though we have not defined any plugins yet ourselves we have been using them already. For example the scaffolding functionality is implemented with a plugin.</p>
</div>
<div class="paragraph">
<p>To add a new plugin to our application we must define a dependency to this plugin. In the file <code>build.gradle</code> we can add new dependencies for our project. Here we can find a section <code>dependencies { &#8230;&#8203; }</code> and this is where we define our plugin dependencies. We can find plugins via the Grails plugin portal on Bintray at <a href="https://bintray.com/grails/plugins" class="bare">https://bintray.com/grails/plugins</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
    dependencies {
        ...
        // Plugin dependencies
        ...
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s extend our G.R.A.I.L.S. application with an RSS feed. The RSS feed will list all villains that are available so far. Other heroes from our network can subscribe to this feed and keep track of the villains.</p>
</div>
<div class="paragraph">
<p>First we add the Feeds plugin to our application. We open <code>build.gradle</code> and add the following line in the <code>dependencies {&#8230;&#8203;}</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
    dependencies {
        ...
        compile "org.grails.plugins:feeds:2.0.0-SNAPSHOT"
        ...
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this plugin we can add a method to our controller and use a nice build syntax to create RSS feed type output.</p>
</div>
<div class="paragraph">
<p>We add a new controller to our application <code>RssController</code> and an action with the name <code>feed</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails create-controller heroes.rss
| Created grails-app/controllers/heroes/RssController.groovy
| Created src/test/groovy/heroes/RssControllerSpec.groovy
&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class RssController {

    def feed() {
        render(feedType: 'rss', feedVersion: '2.0') {
            title = 'All Villains'
            link = createLink(uri: '/', absolute: true)
            description = 'A feed of villains'

            Villain.list(sort: 'firstAppearance', order: 'desc').each { villain -&gt;
                entry(villain.name) {
                    link = createLink(
                            controller: 'villain',
                            action: 'show',
                            id: villain.id,
                            absolute: true)
                    villain.alias
                }
            }
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can run the application and browse to <a href="http://localhost:8080/rss/feed" class="bare">http://localhost:8080/rss/feed</a>. We get the following XML output in a browser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;rss xmlns:ns0="http://purl.org/rss/1.0/modules/content/" version="2.0"&gt;
    &lt;channel&gt;
        &lt;title&gt;All Villains&lt;/title&gt;
        &lt;link&gt;http://localhost:8080/&lt;/link&gt;
        &lt;description&gt;A feed of villains&lt;/description&gt;
        &lt;item&gt;
            &lt;title&gt;Lord Business&lt;/title&gt;
            &lt;link&gt;http://localhost:8080/villain/show/2&lt;/link&gt;
            &lt;ns0:encoded&gt;President Business&lt;/ns0:encoded&gt;
            &lt;guid&gt;http://localhost:8080/villain/show/2&lt;/guid&gt;
        &lt;/item&gt;
        &lt;item&gt;
            &lt;title&gt;Syndrome&lt;/title&gt;
            &lt;link&gt;http://localhost:8080/villain/show/1&lt;/link&gt;
            &lt;ns0:encoded&gt;Buddy Pine&lt;/ns0:encoded&gt;
            &lt;guid&gt;http://localhost:8080/villain/show/1&lt;/guid&gt;
        &lt;/item&gt;
    &lt;/channel&gt;
&lt;/rss&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a RSS feed reader it might look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/rssfeed.png" alt="rssfeed">
</div>
</div>
</div>
</div>
<h1 id="_security" class="sect0">Security</h1>
<div class="openblock partintro">
<div class="content">
Our application is still accessible for everyone. We want to make sure users first need log in and then use the application. To achieve this in our Grails application we can use the <a href="http://grails-plugins.github.io/grails-spring-security-core/v3/index.html">Spring Security plugin</a>. This plugin uses the default Spring Security support, but adds also a lot of configuration options and commands to make it easy to use.
</div>
</div>
<div class="sect1">
<h2 id="_installing_the_plugin">Installing the plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install the plugin we must add an extra dependency to our <code>build.gradle</code> file. We must look for the <code>dependencies</code> section and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
dependencies {
    ...
    compile "org.grails.plugins:spring-security-core:3.0.2"
    ...
}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we run the <code>compile</code> command so all the dependencies are downloaded from the internet.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_users_and_roles">Users and roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default implementation of security with this plugin is to have domain classes for users and roles. To create these classes we use the <code>s2-quickstart</code> command that is added to our Grails application by the plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; grails s2-quickstart heroes User Role
| Creating User class 'User' and Role class 'Role' in package 'heroes'
| Rendered template Person.groovy.template to destination grails-app/domain/heroes/User.groovy
| Rendered template Authority.groovy.template to destination grails-app/domain/heroes/Role.groovy
| Rendered template PersonAuthority.groovy.template to destination grails-app/domain/heroes/UserRole.groovy
|
************************************************************
* Created security-related domain classes. Your            *
* grails-app/conf/application.groovy has been updated with *
* the class names of the configured domain classes;        *
* please verify that the values are correct.               *
************************************************************
&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The output already shows that new classes are generated. Also notice the addition of the a new configuration file <code>grails-app/conf/application.groovy</code>. This configuration file isn&#8217;t in YAML format, but in Groovy. Grails will use both files to configure our application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can also use other ways to implement users and roles, eg. existing systems. For more information <a href="http://grails-plugins.github.io/grails-spring-security-core/v3/index.html" class="bare">http://grails-plugins.github.io/grails-spring-security-core/v3/index.html</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_exercise_4">Exercise</h3>
<div class="ulist">
<ul>
<li>
<p>We have the domain classes <code>User</code>, <code>Role</code> and <code>UserRole</code>. Add code to <code>grails-app/init/Bootstrap.groovy</code> so at least one user with the role name <code>ROLE_HERO</code> is added to the database when the application starts.</p>
</li>
<li>
<p>Start the application. Fill in the username and password of a user. Notice that we cannot access the controllers anymore.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_securing_controllers">Securing controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Security plugin has a lot of options and that also applies on how we want to secure our application endpoints. We can use the <code>@Secured</code> annotation on controllers, we can add rules to the application configuration or even use a database to configure the secured endpoints. We are going to use the <code>@Secured</code> annotation in this workshop.</p>
</div>
<div class="paragraph">
<p>We must apply the annotation to our controllers in the application. We can specify the role name as a value for the annotation, so only logged in users with that role can access the controller.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add the annotation to the <code>VillainController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
@Secured(['ROLE_HERO'])
class VillainController {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now go to the application <a href="http://localhost:8080" class="bare">http://localhost:8080</a>, we should see the output of the <code>VillainController</code> again.</p>
</div>
<div class="sect2">
<h3 id="_exercise_5">Exercise</h3>
<div class="ulist">
<ul>
<li>
<p>Apply the <code>@Secured</code> annotation to the other controllers as well.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logout">Logout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin also adds a new service to our application: <code>SpringSecurityService</code>. We can inject this service into our own controllers and services to use it in our application logic.</p>
</div>
<div class="paragraph">
<p>Also a new taglib is added to our application with the namespace <code>sec</code>. We can use tags to display information about the logged in user, like the username. We are going to add the username to our <code>grails-app/views/layouts/main.gsp</code> so it shows the value on each page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
&lt;div class="nav" role="navigation" id="speciesNav"&gt;
    &lt;sec:ifLoggedIn&gt;
    Welcome &lt;sec:username/&gt;
    &lt;/sec:ifLoggedIn&gt;
    &lt;g:include controller="species" action="allSpecies"/&gt;
&lt;/div&gt;
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check the documentation <a href="http://grails-plugins.github.io/grails-spring-security-core/v3/index.html#securityTagLib" class="bare">http://grails-plugins.github.io/grails-spring-security-core/v3/index.html#securityTagLib</a> for more info.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To logout we must invoke the default action of the <code>LogoutController</code>. The <code>LogoutController</code> is added by the plugin, so we only have to make a link to it. One of the default settings of the security plugin is that the <code>LogoutController</code> only responds to POST requests. We want to support GET as well, therefore we must add an extra configuration property to the file <code>grails-app/conf/application.groovy</code>:</p>
</div>
<div class="paragraph">
<p><code>grails-app/conf/application.groovy</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">...
grails.plugin.springsecurity.logout.postOnly = false
...</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_6">Exercise</h3>
<div class="ulist">
<ul>
<li>
<p>Add a link to the <code>grails-app/views/layouts/main.gsp</code> for the <code>LogoutController</code>. Use the <code>&lt;g:link/&gt;</code> tag.</p>
</li>
<li>
<p>See that is works.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_solutions" class="sect0">Solutions<a id="solutions"></a></h1>
<div class="sect1">
<h2 id="_scaffolding_2">Scaffolding</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><code>grails-app/domain/heroes/Species.groovy</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class Species {

    String name

    static constraints = {
        name(nullable: false, blank: false)
    }

    String toString() {
        name
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/controllers/heroes/SpeciesController.groovy</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class SpeciesController {

    static scaffold = Species

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_views_and_controllers_2">Views and controllers</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><code>grails-app/views/villain/index.gsp</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name="layout" content="main" /&gt;
        &lt;g:set var="entityName" value="${message(code: 'villain.label', default: 'Villain')}" /&gt;
        &lt;title&gt;&lt;g:message code="default.list.label" args="[entityName]" /&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;a href="#list-villain" class="skip" tabindex="-1"&gt;&lt;g:message code="default.link.skip.label" default="Skip to content&amp;hellip;"/&gt;&lt;/a&gt;
        &lt;div class="nav" role="navigation"&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a class="home" href="${createLink(uri: '/')}"&gt;&lt;g:message code="default.home.label"/&gt;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;g:link class="create" action="create"&gt;&lt;g:message code="default.new.label" args="[entityName]" /&gt;&lt;/g:link&gt;&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        &lt;div id="list-villain" class="content scaffold-list" role="main"&gt;
            &lt;h1&gt;&lt;g:message code="default.list.label" args="[entityName]" /&gt; &lt;species:name/&gt;&lt;/h1&gt;
            &lt;g:if test="${flash.message}"&gt;
                &lt;div class="message" role="status"&gt;${flash.message}&lt;/div&gt;
            &lt;/g:if&gt;

            &lt;f:table collection="${villainList}" /&gt;

            &lt;div class="pagination"&gt;
                &lt;g:paginate total="${villainCount ?: 0}" /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/taglib/heroes/SpeciesTaglib.groovy</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package heroes

class SpeciesTagLib {

    static namespace = 'species'

    static defaultEncodeAs = [taglib: 'html']
    //static encodeAsForTags = [tagName: [taglib:'html'], otherTagName: [taglib:'none']]

    def name = { attributes, body -&gt;
        final String paramSpecies = params.species
        if (paramSpecies) {
            final String speciesName = Species.get(paramSpecies).name
            out &lt;&lt; speciesName
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/i18n/messages_nl.properties</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">default.doesnt.match.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] komt niet overeen met het vereiste patroon [{3}]
default.invalid.url.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is geen geldige URL
default.invalid.creditCard.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is geen geldig credit card nummer
default.invalid.email.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is geen geldig e-mailadres
default.invalid.range.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] valt niet in de geldige waardenreeks van [{3}] tot [{4}]
default.invalid.size.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] valt niet in de geldige grootte van [{3}] tot [{4}]
default.invalid.max.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] overschrijdt de maximumwaarde [{3}]
default.invalid.min.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is minder dan de minimumwaarde [{3}]
default.invalid.max.size.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] overschrijdt de maximumgrootte van [{3}]
default.invalid.min.size.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is minder dan minimumgrootte van [{3}]
default.invalid.validator.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] is niet geldig
default.not.inlist.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] komt niet voor in de lijst [{3}]
default.blank.message=Attribuut [{0}] van entiteit [{1}] mag niet leeg zijn
default.not.equal.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] mag niet gelijk zijn aan [{3}]
default.null.message=Attribuut [{0}] van entiteit [{1}] mag niet leeg zijn
default.not.unique.message=Attribuut [{0}] van entiteit [{1}] met waarde [{2}] moet uniek zijn

default.paginate.prev=Vorige
default.paginate.next=Volgende
default.boolean.true=Ja
default.boolean.false=Nee
default.date.format=dd-MM-yyyy HH:mm:ss z
default.number.format=0

default.created.message={0} {1} ingevoerd
default.updated.message={0} {1} gewijzigd
default.deleted.message={0} {1} verwijderd
default.not.deleted.message={0} {1} kon niet worden verwijderd
default.not.found.message={0} met id {1} kon niet worden gevonden
default.optimistic.locking.failure=Een andere gebruiker heeft deze {0} al gewijzigd

default.home.label=Home
default.list.label={0} Overzicht
default.add.label=Toevoegen {0}
default.new.label=Invoeren {0}
default.create.label=Invoeren {0}
default.show.label=Details {0}
default.edit.label=Wijzigen {0}

default.button.create.label=Invoeren
default.button.edit.label=Wijzigen
default.button.update.label=Opslaan
default.button.delete.label=Verwijderen
default.button.delete.confirm.message=Weet je het zeker?

# Data binding errors. Use "typeMismatch.$className.$propertyName to customize (eg typeMismatch.Book.author)
typeMismatch.java.net.URL=Attribuut {0} is geen geldige URL
typeMismatch.java.net.URI=Attribuut {0} is geen geldige URI
typeMismatch.java.util.Date=Attribuut {0} is geen geldige datum
typeMismatch.java.lang.Double=Attribuut {0} is geen geldig nummer
typeMismatch.java.lang.Integer=Attribuut {0} is geen geldig nummer
typeMismatch.java.lang.Long=Attribuut {0} is geen geldig nummer
typeMismatch.java.lang.Short=Attribuut {0} is geen geldig nummer
typeMismatch.java.math.BigDecimal=Attribuut {0} is geen geldig nummer
typeMismatch.java.math.BigInteger=Attribuut {0} is geen geldig nummer

species.label = Soort
species.name.label = Naam

villain.label = Slechterik
villain.name.label = Naam
villain.alias.label = Alias
villain.firstAppearance.label = Voor het eerst gezien op
villain.encounters.label = Ontmoetingen
villain.species.label = Soort

encounter.label = Ontmoeting
encounter.location.label = Locatie
encounter.when.label = Wanneer
encounter.villain.label = Slechterik

tag.copyright.message = Redding door de helden! Ook in {0,date}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_layout_2">Layout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Changes in <code>grails-app/views/layouts/main.gsp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">...
&lt;div class="footer" role="contentinfo"&gt;&lt;heroes:copyright/&gt;&lt;/div&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Styling can be added to the <code>grails-app/views/layouts/main.gsp</code> in the <code>head</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">...
&lt;head&gt;
....
&lt;style&gt;
#speciesNav h2 { display: none; }
h1, h2, h3, a:link, a:visited, a:hover { color: #bf4a00; }
#grailsLogo { background-color: #bf4a00; }
.footer { background: #bf4a00; color: #ffef00; }
&lt;/style&gt;
...
&lt;/head&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or the styling can be added <code>grails-app/assets/stylesheets/main.css</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/views/species/allSpecies.gsp</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;%@ page contentType="text/html;charset=UTF-8" %&gt;
&lt;h2&gt;Species&lt;/h2&gt;

&lt;ul&gt;
    &lt;g:each in="${allSpecies}" var="species"&gt;
        &lt;li&gt;
            &lt;g:link controller="villain"
                    action="index"
                    params="[species: species.id]"&gt;${species.name}&lt;/g:link&gt;
        &lt;/li&gt;
    &lt;/g:each&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_2">Security</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><code>grails-app/init/Bootstrap.groovy</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import heroes.Role
import heroes.Species
import heroes.User
import heroes.UserRole
import heroes.Villain

class BootStrap {

    def init = { servletContext -&gt;
        log.debug('loading Bootstrap')

        Species human = Species.findByName('Human')
        if (!human) {
            human = new Species(name: 'Human').save()
        }

        final Villain syndrome = Villain.findByName('Syndrome')
        if (!syndrome) {
            syndrome = new Villain(
                            name: 'Syndrome',
                            alias: 'Buddy Pine',
                            firstAppearance: Date.parse('dd-MM-yyyy', '01-05-2004'),
                            species: human)
            syndrome.addToEncounters(
                    location: 'Tropical Island',
                    when: Date.parse('dd-MM-yyyy', '13-07-2004'))
            syndrome.save()
        }

        Species lego = Species.findByName('Lego')
        if (!lego) {
            lego = new Species(name: 'Lego').save()
        }

        if (!Villain.findByName('Lord Business')) {
            final Villain lordBusiness =
                    new Villain(
                            name: 'Lord Business',
                            alias: 'President Business',
                            firstAppearance: Date.parse('dd-MM-yyyy', '01-02-2014'),
                            species: lego)
            lordBusiness.addToEncounters(
                    location: 'Desert',
                    when: Date.parse('dd-MM-yyyy', '02-02-2014'))
            lordBusiness.addToEncounters(
                    location: 'Police station',
                    when: Date.parse('dd-MM-yyyy', '12-02-2014'))
            lordBusiness.save()
        }

        log.debug("Initialize app users")
        if (!Role.findByAuthority('ROLE_HERO')) {
            final Role role =
                    new Role(authority: 'ROLE_HERO')
            role.save()
        }
        if (!User.findByUsername('batman')) {
            final User user =
                    new User(
                            username: 'batman',
                            password: 'batcave')

            user.save()

            UserRole.create(user, Role.findByAuthority('ROLE_HERO'), true)
        }
    }

    def destroy = {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/views/layouts/main.gsp</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!doctype html&gt;
&lt;html lang="en" class="no-js"&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
        &lt;title&gt;&lt;g:layoutTitle default="Grails"/&gt;&lt;/title&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
        &lt;asset:stylesheet src="application.css"/&gt;
        &lt;asset:javascript src="application.js"/&gt;

		&lt;style&gt;
		#speciesNav h2 { display: none; }
		h1, h2, h3, a:link, a:visited, a:hover { color: #bf4a00; }
		#grailsLogo { background-color: #bf4a00; }
		.footer { background: #bf4a00; color: #ffef00; }
		&lt;/style&gt;

        &lt;g:layoutHead/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="grailsLogo" role="banner"&gt;&lt;a href="http://grails.org"&gt;&lt;asset:image src="grails_logo.png" alt="Grails"/&gt;&lt;/a&gt;&lt;/div&gt;

        %{-- BEGIN: Added allSpecies navigation here. --}%
        &lt;div class="nav" role="navigation" id="speciesNav"&gt;
            &lt;sec:ifLoggedIn&gt;
            Welcome &lt;sec:username/&gt;
            &lt;g:link controller="logout"&gt;Logout&lt;/g:link&gt;
            &lt;/sec:ifLoggedIn&gt;
            &lt;g:include controller="species" action="allSpecies"/&gt;
        &lt;/div&gt;
        %{-- END: Added allSpecies navigation here. --}%

        &lt;g:layoutBody/&gt;
        &lt;div class="footer" role="contentinfo"&gt;&lt;/div&gt;
        &lt;div id="spinner" class="spinner" style="display:none;"&gt;&lt;g:message code="spinner.alt" default="Loading&amp;hellip;"/&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-01-27 15:00:50 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/groovy.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>